function humanDigits(e,t){var i,s;return 2==t.length?1==e?t[0]:t[1]:(i=0==e||100==e?10:e%100,s="",i>20&&(i%=10,i=0==i?i=10:i),s=1>=i?t[0]:5>i?t[1]:21>i?t[2]:"???")}window.reqAnimationFrame||(window.reqAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)}}()),function(){var e,t,i,s,l,o,r,n,a=[].slice,p={}.hasOwnProperty,u=function(e,t){function i(){this.constructor=e}for(var s in t)p.call(t,s)&&(e[s]=t[s]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};r=function(){},t=function(){function e(){}return e.prototype.addEventListener=e.prototype.on,e.prototype.on=function(e,t){return this._callbacks=this._callbacks||{},this._callbacks[e]||(this._callbacks[e]=[]),this._callbacks[e].push(t),this},e.prototype.emit=function(){var e,t,i,s,l,o;if(s=arguments[0],e=2<=arguments.length?a.call(arguments,1):[],this._callbacks=this._callbacks||{},i=this._callbacks[s])for(l=0,o=i.length;o>l;l++)t=i[l],t.apply(this,e);return this},e.prototype.removeListener=e.prototype.off,e.prototype.removeAllListeners=e.prototype.off,e.prototype.removeEventListener=e.prototype.off,e.prototype.off=function(e,t){var i,s,l,o,r;if(!this._callbacks||0===arguments.length)return this._callbacks={},this;if(s=this._callbacks[e],!s)return this;if(1===arguments.length)return delete this._callbacks[e],this;for(l=o=0,r=s.length;r>o;l=++o)if(i=s[l],i===t){s.splice(l,1);break}return this},e}(),e=function(e){function i(e,t){var l,o,r;if(this.element=e,this.version=i.version,this.defaultOptions.previewTemplate=this.defaultOptions.previewTemplate.replace(/\n*/g,""),this.clickableElements=[],this.listeners=[],this.files=[],"string"==typeof this.element&&(this.element=document.querySelector(this.element)),!this.element||null==this.element.nodeType)throw new Error("Invalid tildaupload element.");if(this.elementid=this.element.getAttribute("id"),this.elementid||(this.elementid="tildaupload"+parseInt(Math.floor(Math.random()*(9e5+1))+99999),this.element.setAttribute("id",this.elementid)),this.element.tildaupload&&console.log("Error: Tildaupload already attached to "+this.elementid),this.options=s({},this.defaultOptions,l,null!=t?t:{}),this.originalelement||(this.originalelement=this.element),"INPUT"==this.element.nodeName){var n=this.options.dicts[this.options.locale].buttonUpload;this.options.uploadMultiple&&(n=this.options.dicts[this.options.locale].buttonUploads),this.element=i.createElement('<div id="'+this.elementid+'-previews"  class="tu-popup-progressbar-container tu-popup-progressbar-start"> <div class="tu-popup-progressbar-error-container"> <div class="tu-popup-progressbar-error-wrapper"> <div class="tu-popup-progressbar-error-text" data-tu-errormessage>Image files allowed only</div> </div> </div> <div class="tu-popup-progressbar-steps"> <div class="tu-popup-progressbar-step3"> <div class="tu-popup-toggler '+this.elementid+'-button" id="'+this.elementid+'-button">'+n+'</div> <div class="tu-popup-progressbar-final '+this.elementid+'-button"> <div class="tu-popup-progressbar-final-text"> <span data-tu-name></span> <span data-tu-size>0KB</span> </div> </div> </div> <div class="tu-popup-progressbar-step2"> <div class="tu-popup-progressbar-checkmark-wrapper"> <div class="tu-popup-progressbar-checkmark"> <div class="tu-popup-progressbar-checkmark_stem"></div> <div class="tu-popup-progressbar-checkmark_kick"></div> </div> </div> </div> <div class="tu-popup-progressbar-step1"> <div class="tu-popup-progressbar-bg" data-tu-uploadprogress></div> <div class="tu-popup-progressbar-text">'+this.options.dicts[this.options.locale].uploading+'</div> <div class="tu-popup-progressbar-close-wrapper" data-tu-remove> <div class="tu-popup-progressbar-close"></div> <div class="tu-popup-progressbar-close-line tu-popup-progressbar-close-line-first"></div> <div class="tu-popup-progressbar-close-line tu-popup-progressbar-close-line-second"></div> </div> </div> </div> </div>'),this.originalelement.parentNode.insertBefore(this.element,this.originalelement),this.originalelement.style.display="none",this.element.style.display=""}if(i.instances.push(this),this.element.tildaupload=this,l=null!=(r=i.optionsForElement(this.element))?r:{},this.options=s({},this.defaultOptions,l,null!=t?t:{}),this.options.forceFallback||!i.isBrowserSupported())return this.options.fallback.call(this);if(null==this.options.url&&(this.options.url=this.element.getAttribute("action")),!this.options.url)throw new Error("No URL provided.");if(this.options.acceptedFiles&&this.options.acceptedMimeTypes)throw new Error("You can't provide both 'acceptedFiles' and 'acceptedMimeTypes'. 'acceptedMimeTypes' is deprecated.");if(this.options.acceptedMimeTypes&&(this.options.acceptedFiles=this.options.acceptedMimeTypes,delete this.options.acceptedMimeTypes),this.options.method=this.options.method.toUpperCase(),(o=this.getExistingFallback())&&o.parentNode&&o.parentNode.removeChild(o),this.options.previewsContainer!==!1&&(this.options.previewsContainer?this.previewsContainer=i.getElement(this.options.previewsContainer,"previewsContainer"):this.previewsContainer=this.element),this.options.uploadMultiple&&(this.options.previewTemplate='<div class="tu-uploader-multiple-img-item tu-js-preview-item"> <div class="tu-uploader-multiple-img-wrapper"> <div class="tu-uploader-multiple-img-separator"></div> <div class="tu-uploader-multiple-img-progressbar" data-tu-uploadprogress="" style="width:0%;"></div> <div class="tu-uploader-multiple-img" data-tu-thumbnail></div> <div class="tu-uploader-multiple-remover" data-tu-remove=""> <div class="tu-uploader-multiple-remover-line tu-uploader-multiple-remover-line-first"></div> <div class="tu-uploader-multiple-remover-line tu-uploader-multiple-remover-line-second"></div> </div> </div> </div>'),this.options.clickable)if(this.options.clickable===!0)if(this.element==this.emptydropzone){var a,p=i.getElements("#"+this.emptydropzone.getAttribute("id")+" .tu-clickable","clickable");for(this.clickableElements=[this.originalelement],a=0;a<p.length;a++)this.clickableElements.push(p[a])}else this.clickableElements=[this.element];else this.clickableElements=i.getElements(this.options.clickable,"clickable");this.init()}var s,l;return u(i,e),i.prototype.Emitter=t,i.prototype.events=["drop","dragstart","dragend","dragenter","dragover","dragleave","addedfile","addedfiles","removedfile","thumbnail","error","errormultiple","processing","processingmultiple","uploadprogress","totaluploadprogress","sending","sendingmultiple","success","successmultiple","canceled","canceledmultiple","complete","completemultiple","reset","maxfilesexceeded","maxfilesreached","queuecomplete"],i.prototype.defaultOptions={url:null,method:"post",withCredentials:!1,parallelUploads:2,uploadMultiple:!1,maxFilesize:10,paramName:"file",createImageThumbnails:!0,maxThumbnailFilesize:10,thumbnailWidth:120,thumbnailHeight:120,filesizeBase:1e3,maxFiles:null,params:{},clickable:!0,ignoreHiddenFiles:!0,acceptedFiles:null,acceptedMimeTypes:null,autoProcessQueue:!0,autoQueue:!0,addRemoveLinks:!1,previewsContainer:null,hiddenInputContainer:"body",capture:null,renameFilename:null,locale:"EN",dicts:{EN:{defaultMessage:"Drop file here to upload",fallbackMessage:"Your browser does not support drag'n'drop file uploads.",fallbackText:"Please use the fallback form below to upload your files like in the olden days.",fileTooBig:"File is too big ({{filesize}}MiB). Max filesize: {{maxFilesize}}MiB.",invalidFileType:"You can't upload files of this type.",responseError:"Server responded with {{statusCode}} code.",bigFileError:"File is too big. Max filesize: 10Mb",cancelUpload:"Cancel upload",cancelUploadConfirmation:"Are you sure you want to cancel this upload?",removeFile:"Remove file",removeFileConfirmation:null,maxFilesExceeded:"You can not upload any more files.",buttonUpload:"Upload file",buttonUploads:"Upload files",buttonUploadImage:"Upload image",buttonUploadImages:"Upload images"},RU:{defaultMessage:"Бросьте файл сюда для загрузки",fallbackMessage:"Ваш браузер не поддерживает драг анд дроп",fallbackText:"Please use the fallback form below to upload your files like in the olden days.",fileTooBig:"Файл слишком большой ({{filesize}}MiB). Максимальный размер: {{maxFilesize}}MiB.",invalidFileType:"Вы не можете загрузить файл этого типа",responseError:"Сервер получил ответ {{statusCode}} код.",bigFileError:"Файл очень большой. Максимальный размер: 10Mb",cancelUpload:"Отмена загрузки",cancelUploadConfirmation:"Вы действительно хотите отменить загрузку?",removeFile:"Удалить файл",removeFileConfirmation:null,maxFilesExceeded:"Вы не можете больше загружать файлы",buttonUpload:"Загрузить файл",buttonUploads:"Загрузить файлы",buttonUploadImage:"Загрузить изображение",buttonUploadImages:"Загрузить изображения"}},accept:function(e,t){return t()},init:function(){return r},forceFallback:!1,fallback:function(){var e,t,s,l,o,r;for(this.element.className=""+this.element.className+" tu-browser-not-supported",r=this.element.getElementsByTagName("div"),l=0,o=r.length;o>l;l++)e=r[l],/(^| )tu-message($| )/.test(e.className)&&(t=e,e.className="tu-message");return t||(t=i.createElement('<div class="tu-message"><span></span></div>'),this.element.appendChild(t)),s=t.getElementsByTagName("span")[0],s&&(null!=s.textContent?s.textContent=this.options.dicts[this.options.locale].fallbackMessage:null!=s.innerText&&(s.innerText=this.options.dicts[this.options.locale].fallbackMessage)),this.element.appendChild(this.getFallbackForm())},resize:function(e){var t,i,s;if(t={srcX:0,srcY:0,srcWidth:e.width,srcHeight:e.height},i=e.width/e.height,!this.options.thumbnailWidth&&!this.options.thumbnailHeight){var l=this.elementid,o=$("#"+l);o&&(this.options.thumbnailWidth=o.width())}return t.optWidth=this.options.thumbnailWidth,t.optHeight=this.options.thumbnailHeight,null==t.optWidth&&null==t.optHeight?(t.optWidth=t.srcWidth,t.optHeight=t.srcHeight):null==t.optWidth?t.optWidth=i*t.optHeight:null==t.optHeight&&(t.optHeight=1/i*t.optWidth),s=t.optWidth/t.optHeight,e.height<t.optHeight||e.width<t.optWidth?(t.trgHeight=t.srcHeight,t.trgWidth=t.srcWidth):i>s?(t.srcHeight=e.height,t.srcWidth=t.srcHeight*s):(t.srcWidth=e.width,t.srcHeight=t.srcWidth/s),t.srcX=(e.width-t.srcWidth)/2,t.srcY=(e.height-t.srcHeight)/2,t},drop:function(e){return this.element.classList.remove("tu-drag-hover")},dragstart:r,dragend:function(e){return this.element.classList.remove("tu-drag-hover")},dragenter:function(e){return this.element.classList.add("tu-drag-hover")},dragover:function(e){return this.element.classList.add("tu-drag-hover")},dragleave:function(e){return this.element.classList.remove("tu-drag-hover")},paste:r,reset:function(){return this.element.classList.remove("tu-started")},addedfile:function(e){var t,s,l,o,r,n,a,p,u,d,c,h,m,g=this.originalelement;g||(g=this.element);var f=g.getAttribute("id");this.element.classList.add("tu-started");var v=document.getElementById("tu-popup");if(this.options.uploadMultiple)if(v){var b=v.querySelector(".tu-popup-content");if(b&&(i.addClass(b,"tu-uploader-multiple-screen"),i.addClass(b,"tu-uploader-has-miltiple-img")),this.previewsContainer=v.querySelector(".tu-uploader-multiple-images"),!e.previewElement){e.previewElement=i.createElement(this.options.previewTemplate.trim());var w=this.previewsContainer.firstChild,y=this.previewsContainer.childNodes.length;y>0&&(1==this.previewsContainer.childNodes[y-1].nodeType?w=this.previewsContainer.childNodes[y-1]:y>1&&1==this.previewsContainer.childNodes[y-2].nodeType&&(w=this.previewsContainer.childNodes[y-2])),this.previewsContainer.insertBefore(e.previewElement,w)}e.previewElement.querySelector("[data-tu-uploadprogress]").style.width="0%";var C=v.querySelectorAll(".tu-js-preview-item").length,U="";U="RU"==this.options.locale?"Вы выбрали "+C+" "+humanDigits(C,["файл","файла","файлов"]):1==C?"You've selected "+C+" file":"You've selected "+C+" files",v.querySelector(".tu-uploader-multiple-title").innerHTML=U,v.querySelector(".tu-uploader-multiple-nav-title").innerHTML=U}else{var F=document.getElementById(f+"-previews");if(F&&F.querySelector(".tu-popup-progressbar-steps")){var E=F.querySelector("[data-tu-uploadprogress]");E&&(E.style.width="0%"),i.removeClass(F,"tu-popup-progressbar-completed"),i.removeClass(F,"tu-popup-progressbar-uploaded"),i.removeClass(F,"tu-popup-progressbar-error"),i.removeClass(F,"tu-popup-progressbar-start")}}else if("IMG"==this.originalelement.nodeName)this.previewsContainer=this.originalelement,this.originalelement.setAttribute("data-tu-thumbnail","");else if("INPUT"==this.originalelement.nodeName){var F=document.getElementById(f+"-previews");if(F&&F.querySelector(".tu-popup-progressbar-steps")){this.previewsContainer=F;var E=F.querySelector("[data-tu-uploadprogress]");E&&(E.style.width="0%"),i.removeClass(F,"tu-popup-progressbar-uploaded"),i.removeClass(F,"tu-popup-progressbar-completed"),i.removeClass(F,"tu-popup-progressbar-error"),i.removeClass(F,"tu-popup-progressbar-start"),e.previewElement=this.previewsContainer}}else this.originalelement.getAttribute("bgimgfield")?(this.previewsContainer=this.originalelement.querySelector(".t-cover__carrier"),this.previewsContainer||(this.previewsContainer=this.originalelement),this.previewsContainer.setAttribute("data-tu-thumbnail",""),e.previewElement=this.previewsContainer):this.previewsContainer=null;if(this.previewsContainer){if(e.previewElement){for(e.previewTemplate=e.previewElement,d=e.previewElement.querySelectorAll("[data-tu-name]"),o=0,a=d.length;a>o;o++)t=d[o],t.textContent=this._renameFilename(e.name),this.options.fileNameSize>0&&t.textContent.length>this.options.fileNameSize&&(t.textContent=t.textContent.substring(0,this.options.fileNameSize-3)+"...");for(c=e.previewElement.querySelectorAll("[data-tu-size]"),r=0,p=c.length;p>r;r++)t=c[r],t.innerHTML=this.filesize(e.size);this.options.addRemoveLinks&&(e._removeLink=i.createElement('<a class="tu-remove" href="javascript:undefined;" data-tu-remove>'+this.options.dicts[this.options.locale].removeFile+"</a>"),e.previewElement.appendChild(e._removeLink))}if(s=function(t){return function(s){return s.preventDefault(),s.stopPropagation(),e.status===i.UPLOADING?i.confirm(t.options.dicts[t.options.locale].cancelUploadConfirmation,function(){return t.removeFile(e)}):t.options.dicts[t.options.locale].removeFileConfirmation?i.confirm(t.options.dicts[t.options.locale].removeFileConfirmation,function(){return t.removeFile(e)}):t.removeFile(e)}}(this),m=[],e.previewElement)for(h=e.previewElement.querySelectorAll("[data-tu-remove]"),n=0,u=h.length;u>n;n++)l=h[n],m.push(l.addEventListener("click",s));return m}},removedfile:function(e){var t;return e.previewElement&&null!=(t=e.previewElement)&&t.parentNode&&t.parentNode.removeChild(e.previewElement),this._updateMaxFilesReachedClass()},thumbnail:function(e,t){var i,s,l,o;if(e.previewElement){for(e.previewElement.classList.remove("tu-file-preview"),o=e.previewElement===this.options.originalelemet&&"IMG"==this.options.originalelement.nodeName.toUpperCase()?[e.previewElement]:e.previewElement===this.previewsContainer&&this.options.originalelement.getAttribute("bgimgfield")?[e.previewElement]:e.previewElement.querySelectorAll("[data-tu-thumbnail]"),s=0,l=o.length;l>s;s++)i=o[s],"IMG"==i.nodeName.toUpperCase()?(i.alt=e.name,i.src=t):(i.style["background-image"]="url("+t+")",i.setAttribute("title",e.name));return setTimeout(function(t){return function(){return e.previewElement.classList.add("tu-image-preview")}}(this),1)}},error:function(e,t){var s,l,o,r,n;if(console.log("ERROR !!! "+t),console.log(e),this.options.uploadMultiple){if(e.previewElement&&e.previewElement.className.indexOf("tu-uploader-multiple-img-item")>-1){var a=e.previewElement.querySelector(".tu-uploader-multiple-img-item-error-text");if(!a){a=i.createElement('<div class="tu-uploader-multiple-img-item-error-wrapper"> <div class="tu-uploader-multiple-img-item-error-icon"> <svg width="34px" height="34px" viewBox="0 0 34 34"> <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <g transform="translate(-28.000000, 0.000000)" fill="#FF2E2E"> <g transform="translate(28.000000, 0.000000)"> <path d="M17,33.6458333 C7.79166667,33.6458333 0.354166667,26.2083333 0.354166667,17 C0.354166667,7.79166667 7.79166667,0.354166667 17,0.354166667 C26.2083333,0.354166667 33.6458333,7.79166667 33.6458333,17 C33.6458333,26.2083333 26.2083333,33.6458333 17,33.6458333 L17,33.6458333 Z M17,1.77083333 C8.57083333,1.77083333 1.77083333,8.57083333 1.77083333,17 C1.77083333,25.4291667 8.57083333,32.2291667 17,32.2291667 C25.4291667,32.2291667 32.2291667,25.4291667 32.2291667,17 C32.2291667,8.57083333 25.4291667,1.77083333 17,1.77083333 L17,1.77083333 Z"></path> <path d="M16.3625,21.1791667 L15.725,12.325 L15.725,8.64166667 L18.275,8.64166667 L18.275,12.325 L17.7083333,21.1791667 L16.3625,21.1791667 L16.3625,21.1791667 Z M15.7958333,25.3583333 L15.7958333,23.0208333 L18.1333333,23.0208333 L18.1333333,25.3583333 L15.7958333,25.3583333 L15.7958333,25.3583333 Z"></path> </g> </g> </g> </svg> </div> <div class="tu-uploader-multiple-img-item-error-text">Upload only images</div> </div>'),e.previewElement.appendChild(a);var a=e.previewElement.querySelector(".tu-uploader-multiple-img-item-error-text")}a.innerHTML=t,i.addClass(e.previewElement,"tu-uploader-multiple-img-item-error")}}else if(this.previewsContainer){this.previewsContainer.classList.add("tu-popup-progressbar-error");var p=this.previewsContainer.querySelector("[data-tu-errormessage]");p&&(p.textContent=t);var u=this;window.setTimeout(function(){u.previewsContainer.classList.add("tu-popup-progressbar-start"),u.previewsContainer.classList.remove("tu-popup-progressbar-error")},1e3)}else if(e.previewElement)for(e.previewElement.classList.add("tu-error"),"String"!=typeof t&&t.error&&(t=t.error),r=e.previewElement.querySelectorAll("[data-tu-errormessage]"),n=[],l=0,o=r.length;o>l;l++)s=r[l],n.push(s.textContent=t);if(this.onUserFail&&!this.options.uploadMultiple){var d=this.onUserFail;d.call(this,e,t)}},errormultiple:function(e,t){if(console.log("["+this.elementid+"] errormultiple in "+e.length+", text: "+t),this.onUserFail&&this.options.uploadMultiple){var i=this.onUserFail;i.call(this,e,t)}},processing:function(e){return e.previewElement&&(e.previewElement.classList.add("tu-processing"),e._removeLink)?e._removeLink.textContent=this.options.dicts[this.options.locale].cancelUpload:void 0},processingmultiple:r,uploadprogress:function(e,t,i){var s,l,o,r,n;if(e.previewElement){for(r=e.previewElement.querySelectorAll("[data-tu-uploadprogress]"),n=[],l=0,o=r.length;o>l;l++)s=r[l],"PROGRESS"===s.nodeName?n.push(s.value=t):n.push(s.style.width=""+t+"%");return n}},totaluploadprogress:r,sending:r,sendingmultiple:r,success:function(e,t){var s=this;if(e.tuInfo||(e.tuInfo={}),e.previewElement){if(this.options.uploadMultiple&&t&&t.result){for(var l=0;l<t.result.length;l++)if(t.result[l].originalUrl==e.name){e.tuInfo=t.result[l],e.previewElement.setAttribute("data-tu-url",t.result[l].cdnUrl);var o=e.previewElement.querySelector("[data-tu-thumbnail]");o&&("IMG"==o.nodeName.toUpperCase()?o.setAttribute("src",t.result[l].cdnUrl):o.style["background-image"]="url("+t.result[l].cdnUrl+")");var r=e.previewElement;window.setTimeout(function(){var e=r.querySelector("[data-tu-uploadprogress]");e&&(e.style.width="0%")},500)}}else if("IMG"==this.element.tagName&&t&&1==t.result.length)e.tuInfo=t.result[0],this.element.setAttribute("src",t.result[0].cdnUrl),e.previewElement!=this.element.parentNode&&(e.previewElement.style.width="100%",e.previewElement.style.display="none",this.element.style.display="");else if(this.previewsContainer.className.indexOf("tu-popup-progressbar-container")>-1){var n=i.getElement("[data-tu-uploadprogress]");n.style.width="100%",i.addClass(s.previewsContainer,"tu-popup-progressbar-uploaded"),window.setTimeout(function(){i.removeClass(s.previewsContainer,"tu-popup-progressbar-uploaded"),i.addClass(s.previewsContainer,"tu-popup-progressbar-completed"),n.style.width="0%"},500)}else if(this.element.getAttribute("bgimgfield")){var a=this.element.querySelector(".t-cover__carrier");a?a.style["background-image"]="url("+t.result[0].cdnUrl+")":this.element.style["background-image"]="url("+t.result[0].cdnUrl+")",this.element.setAttribute("data-tu-value",t.result[0].cdnUrl)}return e.previewElement.classList.add("tu-success")}},successmultiple:r,canceled:function(e){return this.emit("error",e,"Upload canceled.")},canceledmultiple:r,complete:function(e){return e._removeLink&&(e._removeLink.textContent=this.options.dicts[this.options.locale].removeFile),e.previewElement?e.previewElement.classList.add("tu-complete"):void 0},completemultiple:r,maxfilesexceeded:r,maxfilesreached:r,queuecomplete:r,addedfiles:r,previewTemplate:'<div class="tu-preview tu-file-preview" style="width: 180px; float: left; overflow:hidden;"><div class="tu-details dztemplate" style="display:block;position: relative; width: 180px; padding: 5px; overflow: hidden;"> <img data-tu-thumbnail /> <div class="tu-filename"><span data-tu-name id="filenamer"></span></div> <div class="tu-size" data-tu-size></div> <div class="tu-remove-file" data-tu-remove><div class="tu-close"></div></div> </div> <div class="tu-progress" style=""><span class="tu-upload" data-tu-uploadprogress></span></div> <div class="tu-success-mark" style="display:none;"><span>✔</span></div> <div class="tu-error-mark" style="display:none;"><span>✘</span></div><div class="tu-error-message" style="display:none;"><span data-tu-errormessage></span></div></div>'},s=function(){var e,t,i,s,l,o,r;for(s=arguments[0],i=2<=arguments.length?a.call(arguments,1):[],o=0,r=i.length;r>o;o++){t=i[o];for(e in t)l=t[e],s[e]=l}return s},i.prototype.getAcceptedFiles=function(){var e,t,i,s,l;for(s=this.files,l=[],t=0,i=s.length;i>t;t++)e=s[t],e.accepted&&l.push(e);return l},i.prototype.getRejectedFiles=function(){var e,t,i,s,l;for(s=this.files,l=[],t=0,i=s.length;i>t;t++)e=s[t],e.accepted||l.push(e);return l},i.prototype.getFilesWithStatus=function(e){var t,i,s,l,o;for(l=this.files,o=[],i=0,s=l.length;s>i;i++)t=l[i],t.status===e&&o.push(t);return o},i.prototype.getQueuedFiles=function(){return this.getFilesWithStatus(i.QUEUED)},i.prototype.getUploadingFiles=function(){return this.getFilesWithStatus(i.UPLOADING)},i.prototype.getAddedFiles=function(){return this.getFilesWithStatus(i.ADDED)},i.prototype.getActiveFiles=function(){var e,t,s,l,o;for(l=this.files,o=[],t=0,s=l.length;s>t;t++)e=l[t],(e.status===i.UPLOADING||e.status===i.QUEUED)&&o.push(e);return o},i.prototype.init=function(){var e,t,s,l,o,r,n;for("form"===this.element.tagName&&this.element.setAttribute("enctype","multipart/form-data"),this.element.classList.contains("tildaupload")&&!this.element.querySelector(".tu-message")&&this.element.appendChild(i.createElement('<div class="tu-default tu-message"><span>'+this.options.dicts[this.options.locale].defaultMessage+"</span></div>")),s=function(e){return function(){e.hiddenFileInput&&e.hiddenFileInput.parentNode.removeChild(e.hiddenFileInput),e.hiddenFileInput=document.createElement("input"),e.hiddenFileInput.setAttribute("type","file"),(null==e.options.maxFiles||e.options.maxFiles>1)&&e.hiddenFileInput.setAttribute("multiple","multiple"),e.hiddenFileInput.className="tu-hidden-input",null!=e.options.acceptedFiles&&e.hiddenFileInput.setAttribute("accept",e.options.acceptedFiles),null!=e.options.capture&&e.hiddenFileInput.setAttribute("capture",e.options.capture),e.hiddenFileInput.style.visibility="hidden",e.hiddenFileInput.style.position="absolute",e.hiddenFileInput.style.top="0",e.hiddenFileInput.style.left="0",e.hiddenFileInput.style.height="0",e.hiddenFileInput.style.width="0";var t=null;return"string"==typeof e.options.hiddenInputContainer?t=document.querySelector(e.options.hiddenInputContainer):e.options.hiddenInputContainer&&null!=e.options.hiddenInputContainer.nodeType&&(t=e.options.hiddenInputContainer),t||(t=document.querySelector("body")),t.appendChild(e.hiddenFileInput),e.hiddenFileInput.addEventListener("change",function(){var t,i,l,o;if(i=e.hiddenFileInput.files,i.length)for(l=0,o=i.length;o>l;l++)t=i[l],e.addFile(t);return e.emit("addedfiles",i),s()})}}(this),s(),this.URL=null!=(r=window.URL)?r:window.webkitURL,n=this.events,l=0,o=n.length;o>l;l++)e=n[l],this.on(e,this.options[e]);return this.on("uploadprogress",function(e){return function(){return e.updateTotalUploadProgress()}}(this)),this.on("removedfile",function(e){return function(){return e.updateTotalUploadProgress()}}(this)),this.on("canceled",function(e){return function(t){return e.emit("complete",t)}}(this)),this.on("complete",function(e){return function(t){return 0===e.getAddedFiles().length&&0===e.getUploadingFiles().length&&0===e.getQueuedFiles().length?setTimeout(function(){return e.emit("queuecomplete")},0):void 0}}(this)),t=function(e){return e.stopPropagation(),e.preventDefault?e.preventDefault():e.returnValue=!1},this.listeners=[{element:this.element,events:{dragstart:function(e){return function(t){return e.emit("dragstart",t)}}(this),dragenter:function(e){return function(i){return t(i),e.emit("dragenter",i)}}(this),dragover:function(e){return function(i){var s;try{s=i.dataTransfer.effectAllowed}catch(l){}return i.dataTransfer.dropEffect="move"===s||"linkMove"===s?"move":"copy",t(i),e.emit("dragover",i)}}(this),dragleave:function(e){return function(t){return e.emit("dragleave",t)}}(this),drop:function(e){return function(i){return t(i),e.drop(i)}}(this),dragend:function(e){return function(t){return e.emit("dragend",t)}}(this)}}],this.clickableElements.length>0&&this.clickableElements.forEach(function(e){return function(t){return e.listeners.push({element:t,events:{click:function(s){return(t!==e.element||s.target===e.element||i.elementInside(s.target,e.element.querySelector(".tu-message")))&&e.hiddenFileInput.click(),!0}}})}}(this)),this.enable(),this.options.init.call(this)},i.prototype.enableAddDropZone=function(){var e,t=this;if(this.options.additionalDropzone){if(addDropZone=i.getElement(this.options.additionalDropzone),!addDropZone)return[];this.clickableElements=[addDropZone.querySelector(".tu-clickable")],noPropagation=function(e){return e.stopPropagation(),e.preventDefault?e.preventDefault():e.returnValue=!1},e={element:addDropZone,events:{dragstart:function(e){return function(t){return e.emit("dragstart",t)}}(this),dragenter:function(e){return function(t){return noPropagation(t),e.emit("dragenter",t)}}(this),dragover:function(e){return function(t){var i;try{i=t.dataTransfer.effectAllowed}catch(s){}return t.dataTransfer.dropEffect="move"===i||"linkMove"===i?"move":"copy",noPropagation(t),e.emit("dragover",t)}}(this),dragleave:function(e){return function(t){return e.emit("dragleave",t)}}(this),drop:function(e){return function(t){return noPropagation(t),e.drop(t)}}(this),dragend:function(e){return function(t){return e.emit("dragend",t)}}(this)}},this.listeners.push(e),t.addClickableElements=[addDropZone.querySelector(".tu-clickable")],addClickElem={element:t.addClickableElements[0],events:{click:function(e){var t=e.addClickableElements[0];return function(s){return(t!==e.element||s.target===e.element||i.elementInside(s.target,e.element.querySelector(".tu-message")))&&e.hiddenFileInput.click(),!0}}(this)}},this.listeners.push(addClickElem);var s,l,o,r,n,a,p;for(a=[e,addClickElem],p=[],r=0,n=a.length;n>r;r++)s=a[r],p.push(function(){var e,t;e=s.events,t=[];for(l in e)o=e[l],t.push(s.element.addEventListener(l,o,!1));return t}())}},i.prototype.destroy=function(){var e;return this.disable(),this.removeAllFiles(!0),(null!=(e=this.hiddenFileInput)?e.parentNode:void 0)&&(this.hiddenFileInput.parentNode.removeChild(this.hiddenFileInput),this.hiddenFileInput=null),delete this.element.tildaupload,i.instances.splice(i.instances.indexOf(this),1)},i.prototype.updateTotalUploadProgress=function(){var e,t,i,s,l,o,r,n;if(s=0,i=0,e=this.getActiveFiles(),e.length){for(n=this.getActiveFiles(),o=0,r=n.length;r>o;o++)t=n[o],s+=t.upload.bytesSent,i+=t.upload.total;l=100*s/i}else l=100;return this.emit("totaluploadprogress",l,i,s)},i.prototype._getParamName=function(e){return"function"==typeof this.options.paramName?this.options.paramName(e):""+this.options.paramName+(this.options.uploadMultiple?"["+e+"]":"")},i.prototype._renameFilename=function(e){return"function"!=typeof this.options.renameFilename?e:this.options.renameFilename(e)},i.prototype.getFallbackForm=function(){var e,t,s,l;return(e=this.getExistingFallback())?e:(s='<div class="tu-fallback">',this.options.dicts[this.options.locale].fallbackText&&(s+="<p>"+this.options.dicts[this.options.locale].fallbackText+"</p>"),s+='<input type="file" name="'+this._getParamName(0)+'" '+(this.options.uploadMultiple?'multiple="multiple"':void 0)+' /><input type="submit" value="Upload!"></div>',t=i.createElement(s),"FORM"!==this.element.tagName?(l=i.createElement('<form action="'+this.options.url+'" enctype="multipart/form-data" method="'+this.options.method+'"></form>'),l.appendChild(t)):(this.element.setAttribute("enctype","multipart/form-data"),this.element.setAttribute("method",this.options.method)),null!=l?l:t)},i.prototype.getExistingFallback=function(){var e,t,i,s,l,o;for(t=function(e){var t,i,s;for(i=0,s=e.length;s>i;i++)if(t=e[i],/(^| )fallback($| )/.test(t.className))return t},o=["div","form"],s=0,l=o.length;l>s;s++)if(i=o[s],e=t(this.element.getElementsByTagName(i)))return e},i.prototype.setupEventListeners=function(){var e,t,i,s,l,o,r;for(o=this.listeners,r=[],s=0,l=o.length;l>s;s++)e=o[s],r.push(function(){var s,l;s=e.events,l=[];for(t in s)i=s[t],l.push(e.element.addEventListener(t,i,!1));return l}());return r},i.prototype.removeEventListeners=function(){var e,t,i,s,l,o,r;for(o=this.listeners,r=[],s=0,l=o.length;l>s;s++)e=o[s],r.push(function(){var s,l;s=e.events,l=[];for(t in s)i=s[t],l.push(e.element.removeEventListener(t,i,!1));return l}());return r},i.prototype.disable=function(){var e,t,i,s,l;for(this.clickableElements.forEach(function(e){return e.classList.remove("tu-clickable")}),this.removeEventListeners(),s=this.files,l=[],t=0,i=s.length;i>t;t++)e=s[t],l.push(this.cancelUpload(e));return l},i.prototype.enable=function(){return this.clickableElements.forEach(function(e){return e.classList.add("tu-clickable")}),this.setupEventListeners()},i.prototype.filesize=function(e){var t,i,s,l,o,r,n,a;if(s=0,l="b",e>0){for(r=["TB","GB","MB","KB","b"],i=n=0,a=r.length;a>n;i=++n)if(o=r[i],t=Math.pow(this.options.filesizeBase,4-i)/10,e>=t){s=e/Math.pow(this.options.filesizeBase,4-i),l=o;break}s=Math.round(10*s)/10}return"<strong>"+s+"</strong> "+l},i.prototype.sizeUploadedFiles=function(){var e,t,i=0,s="";if(this.files&&this.files.length>0){for(e=0;e<this.files.length;e++)t=this.files[e],i+=t.size;i>1024&&(i=parseFloat(i/1024),s="Kb",i>1024&&(i=parseFloat(i/1024),s="Mb")),i=""+i,i=i.substring(0,4)}return"<strong>"+i+"</strong> "+s},i.prototype._updateMaxFilesReachedClass=function(){return null!=this.options.maxFiles&&this.getAcceptedFiles().length>=this.options.maxFiles?(this.getAcceptedFiles().length===this.options.maxFiles&&this.emit("maxfilesreached",this.files),this.element.classList.add("tu-max-files-reached")):this.element.classList.remove("tu-max-files-reached")},i.prototype.drop=function(e){var t,i;if(e.dataTransfer)if(this.emit("drop",e),t=e.dataTransfer.files,this.emit("addedfiles",t),t.length)i=e.dataTransfer.items,i&&i.length&&null!=i[0].webkitGetAsEntry?this._addFilesFromItems(i):this.handleFiles(t);else if(e.dataTransfer.types&&e.dataTransfer.types.length>0){var s,l,o;for(s in e.dataTransfer.types)if(l=e.dataTransfer.types[s],(l.indexOf("url")>0||l.indexOf("uri-")>0)&&(o=e.dataTransfer.getData(l),o>"")){this._addFilesFromItems([{url:o}]);break}}},i.prototype.paste=function(e){var t,i;if(null!=(null!=e&&null!=(i=e.clipboardData)?i.items:void 0))return this.emit("paste",e),
t=e.clipboardData.items,t.length?this._addFilesFromItems(t):void 0},i.prototype.handleFiles=function(e){var t,i,s,l;for(l=[],i=0,s=e.length;s>i;i++)t=e[i],l.push(this.addFile(t));return l},i.prototype._addFilesFromItems=function(e){var t,i,s,l,o;for(o=[],s=0,l=e.length;l>s;s++)i=e[s],null!=i.webkitGetAsEntry&&(t=i.webkitGetAsEntry())?t.isFile?o.push(this.addFile(i.getAsFile())):t.isDirectory?o.push(this._addFilesFromDirectory(t,t.name)):o.push(void 0):null!=i.getAsFile?null==i.kind||"file"===i.kind?o.push(this.addFile(i.getAsFile())):o.push(void 0):i.url>""?this.uploadFileFromURL(i.url):o.push(void 0);return o},i.prototype._addFilesFromDirectory=function(e,t){var i,s,l;return i=e.createReader(),s=function(e){return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log?console.log(e):void 0},(l=function(e){return function(){return i.readEntries(function(i){var s,o,r;if(i.length>0){for(o=0,r=i.length;r>o;o++)s=i[o],s.isFile?s.file(function(i){return e.options.ignoreHiddenFiles&&"."===i.name.substring(0,1)?void 0:(i.fullPath=""+t+"/"+i.name,e.addFile(i))}):s.isDirectory&&e._addFilesFromDirectory(s,""+t+"/"+s.name);l()}return null},s)}}(this))()},i.prototype.accept=function(e,t){return e.size>1024*this.options.maxFilesize*1024?t(this.options.dicts[this.options.locale].fileTooBig.replace("{{filesize}}",Math.round(e.size/1024/10.24)/100).replace("{{maxFilesize}}",this.options.maxFilesize)):i.isValidFile(e,this.options.acceptedFiles)?null!=this.options.maxFiles&&this.getAcceptedFiles().length>=this.options.maxFiles?(t(this.options.dicts[this.options.locale].maxFilesExceeded.replace("{{maxFiles}}",this.options.maxFiles)),this.emit("maxfilesexceeded",e)):this.options.accept.call(this,e,t):t(this.options.dicts[this.options.locale].invalidFileType)},i.prototype.addFile=function(e){return e.upload={progress:0,total:e.size,bytesSent:0},this.files.push(e),e.status=i.ADDED,this.emit("addedfile",e),this._enqueueThumbnail(e),this.accept(e,function(t){return function(i){return i?(e.accepted=!1,t._errorProcessing([e],i)):(e.accepted=!0,t.options.autoQueue&&t.enqueueFile(e)),t._updateMaxFilesReachedClass()}}(this))},i.prototype.enqueueFiles=function(e){var t,i,s;for(i=0,s=e.length;s>i;i++)t=e[i],this.enqueueFile(t);return null},i.prototype.enqueueFile=function(e){if(e.status!==i.ADDED||e.accepted!==!0)throw new Error("This file can't be queued because it has already been processed or was rejected.");return e.status=i.QUEUED,this.options.autoProcessQueue?setTimeout(function(e){return function(){return e.processQueue()}}(this),0):void 0},i.prototype._thumbnailQueue=[],i.prototype._processingThumbnail=!1,i.prototype._enqueueThumbnail=function(e){return this.options.createImageThumbnails&&e.type.match(/image.*/)&&e.size<=1024*this.options.maxThumbnailFilesize*1024?(this._thumbnailQueue.push(e),setTimeout(function(e){return function(){return e._processThumbnailQueue()}}(this),0)):void 0},i.prototype._processThumbnailQueue=function(){return this._processingThumbnail||0===this._thumbnailQueue.length?void 0:(this._processingThumbnail=!0,this.createThumbnail(this._thumbnailQueue.shift(),function(e){return function(){return e._processingThumbnail=!1,e._processThumbnailQueue()}}(this)))},i.prototype.removeFile=function(e){return e.status===i.UPLOADING&&this.cancelUpload(e),this.files=n(this.files,e),this.emit("removedfile",e),0===this.files.length?this.emit("reset"):void 0},i.prototype.removeAllFiles=function(e){var t,s,l,o;for(null==e&&(e=!1),o=this.files.slice(),s=0,l=o.length;l>s;s++)t=o[s],(t.status!==i.UPLOADING||e)&&this.removeFile(t);return null},i.prototype.createThumbnail=function(e,t){var i;return i=new FileReader,i.onload=function(s){return function(){return"image/svg+xml"===e.type?(s.emit("thumbnail",e,i.result),void(null!=t&&t())):s.createThumbnailFromUrl(e,i.result,t)}}(this),i.readAsDataURL(e)},i.prototype.createThumbnailFromUrl=function(e,t,i,s){var l;return l=document.createElement("img"),s&&(l.crossOrigin=s),l.onload=function(t){return function(){var s,r,n,a,p,u,d,c;return e.width=l.width,e.height=l.height,n=t.options.resize.call(t,e),null==n.trgWidth&&(n.trgWidth=n.optWidth),null==n.trgHeight&&(n.trgHeight=n.optHeight),s=document.createElement("canvas"),r=s.getContext("2d"),s.width=n.trgWidth,s.height=n.trgHeight,o(r,l,null!=(p=n.srcX)?p:0,null!=(u=n.srcY)?u:0,n.srcWidth,n.srcHeight,null!=(d=n.trgX)?d:0,null!=(c=n.trgY)?c:0,n.trgWidth,n.trgHeight),a=s.toDataURL("image/png"),t.emit("thumbnail",e,a),null!=i?i():void 0}}(this),null!=i&&(l.onerror=i),l.src=t},i.prototype.processQueue=function(){var e,t,i,s;if(t=this.options.parallelUploads,i=this.getUploadingFiles().length,e=i,!(i>=t)&&(s=this.getQueuedFiles(),s.length>0)){if(this.options.uploadMultiple)return this.processFiles(s.slice(0,t-i));for(;t>e;){if(!s.length)return;this.processFile(s.shift()),e++}}},i.prototype.processFile=function(e){return this.processFiles([e])},i.prototype.processFiles=function(e){var t,s,l;for(s=0,l=e.length;l>s;s++)t=e[s],t.processing=!0,t.status=i.UPLOADING,this.emit("processing",t);return this.options.uploadMultiple&&this.emit("processingmultiple",e),this.uploadFiles(e)},i.prototype._getFilesWithXhr=function(e){var t,i;return i=function(){var i,s,l,o;for(l=this.files,o=[],i=0,s=l.length;s>i;i++)t=l[i],t.xhr===e&&o.push(t);return o}.call(this)},i.prototype.cancelUpload=function(e){var t,s,l,o,r,n,a;if(e.status===i.UPLOADING){for(s=this._getFilesWithXhr(e.xhr),l=0,r=s.length;r>l;l++)t=s[l],t.status=i.CANCELED;for(e.xhr.abort(),o=0,n=s.length;n>o;o++)t=s[o],this.emit("canceled",t);this.options.uploadMultiple&&this.emit("canceledmultiple",s)}else((a=e.status)===i.ADDED||a===i.QUEUED)&&(e.status=i.CANCELED,this.emit("canceled",e),this.options.uploadMultiple&&this.emit("canceledmultiple",[e]));return this.options.autoProcessQueue?this.processQueue():void 0},l=function(){var e,t;return t=arguments[0],e=2<=arguments.length?a.call(arguments,1):[],"function"==typeof t?t.apply(this,e):t},i.prototype.uploadFile=function(e){return this.uploadFiles([e])},i.prototype.uploadFiles=function(e){var t,o,r,n,a,p,u,d,c,h,m,g,f,v,b,w,y,C,U,F,E,T,k,L,x,N,$,A,M,I,D,W,S,_;for(U=new XMLHttpRequest,F=0,L=e.length;L>F;F++)t=e[F],t.xhr=U;g=l(this.options.method,e);var P="";this.element.getAttribute("data-tu-max-width")>0&&(P+="&maxwidth="+parseInt(this.element.getAttribute("data-tu-max-width"))),this.element.getAttribute("data-tu-max-height")>0&&(P+="&maxheight="+parseInt(this.element.getAttribute("data-tu-max-height"))),this.element.getAttribute("data-tu-cover")&&""!=this.element.getAttribute("data-tu-cover")&&(P+="&crop="+this.element.getAttribute("data-tu-cover")),y=l(this.options.url,e),U.open(g,y+P,!0),U.withCredentials=!!this.options.withCredentials,b=null,r=function(i){return function(){var s,l,o;for(o=[],s=0,l=e.length;l>s;s++)t=e[s],0==U.status?o.push(i._errorProcessing(e,b||i.options.dicts[i.options.locale].bigFileError,U)):o.push(i._errorProcessing(e,b||i.options.dicts[i.options.locale].responseError.replace("{{statusCode}}",U.status),U));return o}}(this),w=function(i){return function(s){var l,o,r,n,a,p,u,d,c;if(null!=s)for(o=100*s.loaded/s.total,r=0,p=e.length;p>r;r++)t=e[r],t.upload={progress:o,total:s.total,bytesSent:s.loaded};else{for(l=!0,o=100,n=0,u=e.length;u>n;n++)t=e[n],(100!==t.upload.progress||t.upload.bytesSent!==t.upload.total)&&(l=!1),t.upload.progress=o,t.upload.bytesSent=t.upload.total;if(l)return}for(c=[],a=0,d=e.length;d>a;a++)t=e[a],c.push(i.emit("uploadprogress",t,o,t.upload.bytesSent));return c}}(this),U.onload=function(t){return function(s){var l;if(e[0].status!==i.CANCELED&&4===U.readyState){if(b=U.responseText,U.getResponseHeader("content-type")&&~U.getResponseHeader("content-type").indexOf("application/json"))try{b=JSON.parse(b)}catch(o){s=o,b="Invalid JSON response from server."}return w(),200<=(l=U.status)&&300>l?t._finished(e,b,s):r()}}}(this),U.onerror=function(t){return function(){return e[0].status!==i.CANCELED?r():void 0}}(this),v=null!=(M=U.upload)?M:U,v.onprogress=w,p={Accept:"application/json","Cache-Control":"no-cache","X-Requested-With":"XMLHttpRequest"},this.options.headers&&s(p,this.options.headers);for(n in p)a=p[n],a&&U.setRequestHeader(n,a);if(o=new FormData,Tildaupload_PUBLICKEY&&o.append("publickey",Tildaupload_PUBLICKEY),this.options.params){I=this.options.params;for(m in I)C=I[m],o.append(m,C)}for(E=0,x=e.length;x>E;E++)t=e[E],this.emit("sending",t,U,o);if(this.options.uploadMultiple&&this.emit("sendingmultiple",e,U,o),"FORM"===this.element.tagName)for(D=this.element.querySelectorAll("input, textarea, select, button"),T=0,N=D.length;N>T;T++)if(d=D[T],c=d.getAttribute("name"),h=d.getAttribute("type"),"SELECT"===d.tagName&&d.hasAttribute("multiple"))for(W=d.options,k=0,$=W.length;$>k;k++)f=W[k],f.selected&&o.append(c,f.value);else(!h||"checkbox"!==(S=h.toLowerCase())&&"radio"!==S||d.checked)&&o.append(c,d.value);for(u=A=0,_=e.length-1;_>=0?_>=A:A>=_;u=_>=0?++A:--A)o.append(this._getParamName(u),e[u],this._renameFilename(e[u].name));return this.submitRequest(U,o,e)},i.prototype.submitRequest=function(e,t,i){return e.send(t)},i.prototype._finished=function(e,t,s){var l,o,r;for(o=0,r=e.length;r>o;o++)l=e[o],l.status=i.SUCCESS,this.emit("success",l,t,s),this.emit("complete",l);return this.options.uploadMultiple&&(this.emit("successmultiple",e,t,s),this.emit("completemultiple",e)),this.options.autoProcessQueue?this.processQueue():void 0},i.prototype._errorProcessing=function(e,t,s){var l,o,r;for(o=0,r=e.length;r>o;o++)l=e[o],l.status=i.ERROR,this.emit("error",l,t,s),this.emit("complete",l);return this.options.uploadMultiple&&(this.emit("errormultiple",e,t,s),this.emit("completemultiple",e)),this.options.autoProcessQueue?this.processQueue():void 0},i.prototype.uploadFileFromURL=function(e){var t=this.originalelement;t||(t=this.element);var s=t.getAttribute("id"),l=this,o=e.split("\n");o&&o.length>1&&(e=o[0]);var r={url:e,name:e,size:""};r.upload={progress:0,total:r.size,bytesSent:0},l.files.push(r),r.status=i.ADDED,l.emit("addedfile",r);var n="";this.element.getAttribute("data-tu-max-width")>0&&(n+="&maxwidth="+parseInt(this.element.getAttribute("data-tu-max-width"))),this.element.getAttribute("data-tu-max-height")>0&&(n+="&maxheight="+parseInt(this.element.getAttribute("data-tu-max-height"))),this.element.getAttribute("data-tu-cover")&&""!=this.element.getAttribute("data-tu-cover")&&(n+="&crop="+this.element.getAttribute("data-tu-cover")),$.ajax({url:this.options.url+n,type:"POST",dataType:"text",timeout:1e4,data:{url:e,publickey:Tildaupload_PUBLICKEY},beforeSend:function(){$("#"+s+"-previews").css({display:"inline-block"});var e=$("#"+s+"-previews");e.length>0&&e.removeClass("tu-popup-progressbar-error").removeClass("tu-popup-progressbar-completed").removeClass("tu-popup-progressbar-uploaded").removeClass("tu-popup-progressbar-start"),TUWidget.hideUploader()},xhr:function(){var e=$.ajaxSettings.xhr();return e.upload.addEventListener("progress",function(e){if(e.lengthComputable){var t=Math.ceil(e.loaded/e.total*100);l.emit("progress",t,e.loaded)}},!1),e},success:function(t){t&&"string"==typeof t&&"{"==t.substring(0,1)?t=$.parseJSON(t):console.log(t);var i=($("#tu-popup"),$("#"+s)),o=l;if(t&&t.result&&t.result[0].cdnUrl>"")return l._finished(l.files,t),!0;var o=i.data("tildaupload"),r=$("#"+s+"-previews");if(r.removeClass("tu-popup-progressbar-completed"),r.removeClass("tu-popup-progressbar-start"),r.addClass("tu-popup-progressbar-error"),o.onUserFail&&!o.options.uploadMultiple){var n=o.onUserFail;n.call(o,e,t)}},error:function(t){console.log("error"),console.log(t);var i=$elem.data("tildaupload");if(i.onUserFail&&!i.options.uploadMultiple){var s=i.onUserFail;s.call(i,e,t)}}})},i.prototype.done=function(e){return this.onUserDone=e,this},i.prototype.fail=function(e){return this.onUserFail=e,this},i.prototype.progress=function(e){return this.onUserProgress=e,this},i}(t),e.version="4.3.0",e.options={},e.optionsForElement=function(t){return t.getAttribute("id")?e.options[i(t.getAttribute("id"))]:void 0},e.instances=[],e.forElement=function(e){if("string"==typeof e&&(e=document.querySelector(e)),null==(null!=e?e.tildaupload:void 0))throw new Error("No Tildaupload found for given element. This is probably because you're trying to access it before Tildaupload had the time to initialize. Use the `init` option to setup any additional observers on your Tildaupload.");return e.tildaupload},e.autoDiscover=!0,e.discover=function(){var t,i,s,l,o,r;for(document.querySelectorAll?s=document.querySelectorAll(".tildaupload"):(s=[],t=function(e){var t,i,l,o;for(o=[],i=0,l=e.length;l>i;i++)t=e[i],/(^| )tildaupload($| )/.test(t.className)?o.push(s.push(t)):o.push(void 0);return o},t(document.getElementsByTagName("div")),t(document.getElementsByTagName("form"))),r=[],l=0,o=s.length;o>l;l++)i=s[l],e.optionsForElement(i)!==!1?r.push(new e(i)):r.push(void 0);return r},e.blacklistedBrowsers=[/opera.*Macintosh.*version\/12/i],e.isBrowserSupported=function(){var t,i,s,l,o;if(t=!0,window.File&&window.FileReader&&window.FileList&&window.Blob&&window.FormData&&document.querySelector)if("classList"in document.createElement("a"))for(o=e.blacklistedBrowsers,s=0,l=o.length;l>s;s++)i=o[s],i.test(navigator.userAgent)&&(t=!1);else t=!1;else t=!1;return t},n=function(e,t){var i,s,l,o;for(o=[],s=0,l=e.length;l>s;s++)i=e[s],i!==t&&o.push(i);return o},i=function(e){return e.replace(/[\-_](\w)/g,function(e){return e.charAt(1).toUpperCase()})},e.createElement=function(e){var t;return t=document.createElement("div"),t.innerHTML=e,t.childNodes[0]},e.elementInside=function(e,t){if(e===t)return!0;for(;e=e.parentNode;)if(e===t)return!0;return!1},e.addClass=function(e,t){var i;"string"==typeof e?i=document.querySelector(e):null!=e.nodeType&&(i=e),i&&(i.classList?i.classList.add(t):i.className.indexOf(t)>-1&&(i.className+=t))},e.removeClass=function(e,t){var i;"string"==typeof e?i=document.querySelector(e):null!=e.nodeType&&(i=e),i&&(i.classList?i.classList.remove(t):i.className=i.className.replace("/\b"+t+"/g",""))},e.getElement=function(e,t){var i;if("string"==typeof e?i=document.querySelector(e):null!=e.nodeType&&(i=e),null==i)throw new Error("Invalid `"+t+"` option provided. Please provide a CSS selector or a plain HTML element.");return i},e.getElements=function(e,t){var i,s,l,o,r,n,a,p;if(e instanceof Array){l=[];try{for(o=0,n=e.length;n>o;o++)s=e[o],l.push(this.getElement(s,t))}catch(u){i=u,l=null}}else if("string"==typeof e)for(l=[],p=document.querySelectorAll(e),r=0,a=p.length;a>r;r++)s=p[r],l.push(s);else null!=e.nodeType&&(l=[e]);if(null==l||!l.length)throw new Error("Invalid `"+t+"` option provided. Please provide a CSS selector, a plain HTML element or a list of those.");return l},e.confirm=function(e,t,i){return window.confirm(e)?t():null!=i?i():void 0},e.isValidFile=function(e,t){var i,s,l,o,r;if(!t)return!0;for(t=t.split(","),s=e.type,i=s.replace(/\/.*$/,""),o=0,r=t.length;r>o;o++)if(l=t[o],l=l.trim(),"."===l.charAt(0)){if(-1!==e.name.toLowerCase().indexOf(l.toLowerCase(),e.name.length-l.length))return!0}else if(/\/\*$/.test(l)){if(i===l.replace(/\/.*$/,""))return!0}else if(s===l)return!0;return!1},e.animate=function(e,t,i,s){var l,o,r,n;l="slow"==i?500:"fast"==i?17:i>0?i:100;for(cssName in t)void 0!==e.style[cssName]&&(t[cssName].start||(t[cssName].start=0),t[cssName].start<t[cssName].end?t[cssName].step=Math.abs(t[cssName].step):t[cssName].step=-Math.abs(t[cssName].step),e.style[cssName]=t[cssName].start,r=""+t[cssName].start,o=r.length,r=r.substring(o-2),"px"==r?t[cssName].unit="px":"pt"==r?t[cssName].unit="pt":"%"==r.substring(1)?t[cssName].unit="%":t[cssName].unit="");!function a(){var i=!0;for(cssName in t)void 0!==e.style[cssName]&&(t[cssName].start<t[cssName].end&&e.style[cssName]<t[cssName].end||t[cssName].start>t[cssName].end&&e.style[cssName]>t[cssName].end)&&(n=t[cssName].step>0&&t[cssName].step<1?parseFloat(e.style[cssName])+parseFloat(t[cssName].step):parseInt(e.style[cssName])+parseInt(t[cssName].step),e.style[cssName]=n+t[cssName].unit,i=!1);i?"function"==typeof s&&s(e):setTimeout(function(){window.reqAnimationFrame(a)},l)}()},"undefined"!=typeof jQuery&&null!==jQuery&&(jQuery.fn.tildaupload=function(t){return this.each(function(){return new e(this,t)})}),"undefined"!=typeof module&&null!==module?module.exports=e:window.Tildaupload=e,e.ADDED="added",e.QUEUED="queued",e.ACCEPTED=e.QUEUED,e.UPLOADING="uploading",e.PROCESSING=e.UPLOADING,e.CANCELED="canceled",e.ERROR="error",e.SUCCESS="success",l=function(e){var t,i,s,l,o,r,n,a,p,u;for(n=e.naturalWidth,r=e.naturalHeight,i=document.createElement("canvas"),i.width=1,i.height=r,s=i.getContext("2d"),s.drawImage(e,0,0),l=s.getImageData(0,0,1,r).data,u=0,o=r,a=r;a>u;)t=l[4*(a-1)+3],0===t?o=a:u=a,a=o+u>>1;return p=a/r,0===p?1:p},o=function(e,t,i,s,o,r,n,a,p,u){var d;return d=l(t),e.drawImage(t,i,s,o,r,n,a,p,u/d)},s=function(e,t){var i,s,l,o,r,n,a,p,u;if(l=!1,u=!0,s=e.document,p=s.documentElement,i=s.addEventListener?"addEventListener":"attachEvent",a=s.addEventListener?"removeEventListener":"detachEvent",n=s.addEventListener?"":"on",o=function(i){return"readystatechange"!==i.type||"complete"===s.readyState?(("load"===i.type?e:s)[a](n+i.type,o,!1),!l&&(l=!0)?t.call(e,i.type||i):void 0):void 0},r=function(){var e;try{p.doScroll("left")}catch(t){return e=t,void setTimeout(r,50)}return o("poll")},"complete"!==s.readyState){if(s.createEventObject&&p.doScroll){try{u=!e.frameElement}catch(d){}u&&r()}return s[i](n+"DOMContentLoaded",o,!1),s[i](n+"readystatechange",o,!1),e[i](n+"load",o,!1)}},e._autoDiscoverFunction=function(){return e.autoDiscover?e.discover():void 0},s(window,e._autoDiscoverFunction)}.call(this),$(document).ready(function(){TUWidget={urlUploadAPI:"https://api.tildacdn.com/api/upload/",locale:"EN",dicts:{EN:{defaultMessage:"Drop files here to upload",fallbackMessage:"Your browser does not support drag'n'drop file uploads.",fallbackText:"Please use the fallback form below to upload your files like in the olden days.",fileTooBig:"File is too big ({{filesize}}MiB). Max filesize: {{maxFilesize}}MiB.",invalidFileType:"You can't upload files of this type.",responseError:"Server responded with {{statusCode}} code.",cancelUpload:"Cancel upload",cancelUploadConfirmation:"Are you sure you want to cancel this upload?",removeFile:"Remove file",removeFileConfirmation:null,removeAll:"Remove All",browseFiles:"Browse files",fileFromTheWeb:"File from the web",maxFilesExceeded:"You can not upload any more files.",buttonUploadLink:"Upload",buttonUpload:"Upload file",buttonUploads:"Upload files",buttonUploadImage:"Upload image",buttonUploadImages:"Upload images",backToLocalUpload:"Back to local upload",uploadToLink:"Upload to link",uploadToPaste:"Paste",attentionToLink:"Grab any file off the web. Just provide the link.",pasteLink:"Paste your link here",uploading:"Uploading",uploadSelected:"Upload selected",selected:"You’ve selected {cnt} files"},RU:{defaultMessage:"Бросьте файл сюда для загрузки",fallbackMessage:"Ваш браузер не поддерживает драг анд дроп",fallbackText:"Please use the fallback form below to upload your files like in the olden days.",fileTooBig:"Файл слишком большой ({{filesize}}MiB). Максимальный размер: {{maxFilesize}}MiB.",invalidFileType:"Вы не можете загрузить файл этого типа",responseError:"Сервер получил ответ {{statusCode}} код.",cancelUpload:"Отмена загрузки",cancelUploadConfirmation:"Вы действительно хотите отменить загрузку?",removeFile:"Удалить файл",removeFileConfirmation:null,removeAll:"Удалить все",browseFiles:"Посмотреть файлы",maxFilesExceeded:"Вы не можете больше загружать файлы",fileFromTheWeb:"Файл по ссылке",buttonUploadLink:"Загрузить",buttonUpload:"Загрузить файл",buttonUploads:"Загрузить файлы",buttonUploadImage:"Загрузить изображение",buttonUploadImages:"Загрузить изображения",uploadToLink:"Загрузка по ссылке",uploadToPaste:"Вставить",backToLocalUpload:"Вернуться к загрузке файлов с компьютера",attentionToLink:"Загрузите любой файл из сети. Просто укажите ссылку.",pasteLink:"Вставьте ссылку сюда",uploading:"Загрузка",uploadSelected:"Загрузить выбранное",selected:"Вы выбрали {cnt}"}}},"RU"==$("body").data("lang")?TUWidget.locale="RU":TUWidget.locale="EN",Tildaupload.autoDiscover=!1,TUWidget.htmlPopup='<div class="tu-popup" id="tu-popup"> <div class="tu-popup-container"> <div class="tu-popup-bg"><input type="text" value="" id="tu-hidden-input-paste" style="position:absolute; opacity:0;width:1px; height:1px;"></div> <div class="tu-popup-close"> <div class="tu-popup-close-line tu-popup-close-line-first"></div> <div class="tu-popup-close-line tu-popup-close-line-second"></div> </div> <div class="tu-popup-wrapper"><div class="tu-popup-closer"></div><div class="tu-popup-content" style="display: block;"> <div class="tu-uploader-steps"> <!-- Muliple screen --> <div class="tu-uploader-multiple"> <div class="tu-uploader-multiple-header"> <div class="tu-uploader-multiple-title"> </div> <div class="tu-uploader-multiple-buttons"> <div class="tu-uploader-multiple-btn tu-uploader-multiple-btn-gray tu-js-removeall">'+TUWidget.dicts[TUWidget.locale].removeAll+'</div> <div class="tu-uploader-multiple-btn tu-uploader-multiple-btn-orange tu-js-selected">'+TUWidget.dicts[TUWidget.locale].uploadSelected+'</div> </div> </div> <div class="tu-uploader-multiple-images"> <div class="tu-uploader-multiple-img-item"> <div class="tu-uploader-multiple-addmore-wrapper"> <div class="tu-uploader-multiple-addmore-separator"></div> <div class="tu-uploader-multiple-addmore-plus"> <div class="tu-uploader-multiple-addmore-plus-line tu-uploader-multiple-addmore-plus-line-first"></div> <div class="tu-uploader-multiple-addmore-plus-line tu-uploader-multiple-addmore-plus-line-second"></div> </div> </div> </div> </div> </div> <!-- uploader main screen --> <div class="tu-uploader-wrapper"> <!--multiple--><div class="tu-uploader-multiple-nav"> <div class="tu-uploader-multiple-nav-title">'+TUWidget.dicts[TUWidget.locale].defaultMessage+'</div> <div class="tu-uploader-multiple-nav-btn">'+TUWidget.dicts[TUWidget.locale].browseFiles+'</div> </div> <!--/end multiple--> <div class="tu-uploader-area"></div> <div class="tu-uploader-title tu-title-lg">'+TUWidget.dicts[TUWidget.locale].defaultMessage+'</div> <div class="tu-uploader-button-wrapper"> <div class="tu-uploader-button tu-clickable">'+TUWidget.dicts[TUWidget.locale].buttonUpload+'</div> </div> <div class="tu-uploader-link-wrapper"> <div class="tu-uploader-link-img"> <svg version="1.1" viewBox="0 0 14 14" height="14px" width="14px"> <g fill-rule="evenodd" fill="none" stroke-width="1" stroke="none"> <g fill="#CCCCCC" transform="translate(-311.000000, -503.000000)" sketch:type="MSLayerGroup"> <g transform="translate(311.000000, 503.000000)"> <path id="Shape" d="M9.63740351,6.15189474 C9.46621053,5.76726316 9.22624561,5.40522807 8.91063158,5.08961404 C8.59477193,4.77424561 8.23298246,4.53403509 7.84835088,4.36284211 L7.37185965,4.83933333 L7.04077193,5.17017544 L6.69715789,5.51378947 C6.63329825,5.57740351 6.57901754,5.64666667 6.53161404,5.71912281 C6.9877193,5.74884211 7.41459649,5.93280702 7.74077193,6.25922807 C8.0762807,6.59449123 8.25066667,7.0262807 8.27964912,7.46568421 C8.29610526,7.70982456 8.26589474,7.95445614 8.18754386,8.18901754 C8.10059649,8.44985965 7.96059649,8.6957193 7.75722807,8.90547368 C7.75084211,8.91161404 7.74715789,8.91922807 7.74126316,8.92536842 L7.35098246,9.31515789 L6.80964912,9.85649123 L6.30466667,10.3617193 L4.98842105,11.6779649 C4.6322807,12.0341053 4.15922807,12.2298596 3.65522807,12.2298596 C3.15221053,12.2298596 2.67817544,12.033614 2.32203509,11.6774737 C1.96638596,11.3218246 1.77038596,10.8482807 1.77038596,10.3447719 C1.77038596,9.84126316 1.96614035,9.36747368 2.3222807,9.01157895 L3.64049123,7.69312281 C3.56508772,7.45929825 3.51129825,7.22007018 3.47814035,6.97863158 C3.45357895,6.79859649 3.43687719,6.61757895 3.43614035,6.43607018 C3.43368421,6.10252632 3.47494737,5.76922807 3.55207018,5.44280702 L1.15242105,7.84221053 C-0.229157895,9.2242807 -0.229157895,11.4652632 1.15242105,12.8473333 C1.84357895,13.538 2.74915789,13.8838246 3.65473684,13.8838246 C4.56080702,13.8838246 5.46638596,13.5382456 6.15729825,12.8473333 L8.55326316,10.4513684 L8.91014035,10.0949825 C9.11424561,9.89063158 9.28470175,9.66564912 9.42838596,9.42936842 C9.65459649,9.05849123 9.80835088,8.65666667 9.88522807,8.24207018 C9.92477193,8.02887719 9.94589474,7.81298246 9.94589474,7.59659649 C9.94638596,7.3325614 9.91396491,7.06901754 9.85550877,6.81014035 C9.80540351,6.58540351 9.73270175,6.36508772 9.63740351,6.15189474 L9.63740351,6.15189474 Z"/> <path id="Shape" d="M12.8473333,1.15291228 C12.1561754,0.462 11.2503509,0.116421053 10.3450175,0.116421053 C9.43894737,0.116666667 8.53336842,0.462 7.84245614,1.15315789 L5.44673684,3.54887719 L5.08985965,3.90575439 C4.88550877,4.11010526 4.71529825,4.33508772 4.57136842,4.57112281 C4.34540351,4.942 4.19140351,5.34382456 4.1142807,5.75842105 C4.07473684,5.97161404 4.05361404,6.18775439 4.05361404,6.40389474 C4.05336842,6.66792982 4.08554386,6.93147368 4.144,7.19059649 C4.19484211,7.41508772 4.26754386,7.63540351 4.36284211,7.84884211 C4.53403509,8.23322807 4.77375439,8.59501754 5.08961404,8.91063158 C5.40547368,9.22624561 5.76701754,9.46621053 6.15189474,9.63764912 L6.62814035,9.16140351 L6.95922807,8.8305614 L7.30259649,8.48719298 C7.36645614,8.42333333 7.42098246,8.35407018 7.46838596,8.28136842 C7.01203509,8.25164912 6.58515789,8.06792982 6.25873684,7.74126316 C5.92273684,7.40550877 5.74835088,6.97273684 5.71936842,6.53235088 C5.70364912,6.28894737 5.73435088,6.04554386 5.81221053,5.81147368 C5.89866667,5.55063158 6.03866667,5.30452632 6.24252632,5.09501754 C6.24866667,5.08887719 6.25259649,5.08150877 6.25873684,5.07512281 L6.64877193,4.68508772 L7.19035088,4.14375439 L7.69557895,3.63852632 L9.01157895,2.32277193 C9.3677193,1.96663158 9.84101754,1.77038596 10.3450175,1.77038596 C10.8485263,1.77038596 11.3220702,1.96663158 11.6777193,2.32252632 C12.4130877,3.05764912 12.4130877,4.25378947 11.6782105,4.98866667 L10.3595088,6.30712281 C10.4351579,6.54119298 10.4887018,6.78017544 10.5218596,7.02185965 C10.5466667,7.20189474 10.5631228,7.38291228 10.5638596,7.56417544 C10.5663158,7.89796491 10.5252982,8.23101754 10.4474386,8.5574386 L12.8473333,6.15803509 C14.2289123,4.77596491 14.2289123,2.53498246 12.8473333,1.15291228 L12.8473333,1.15291228 Z"/> </g> </g> </g> </svg> </div> <div class="tu-uploader-link">'+TUWidget.dicts[TUWidget.locale].uploadToLink+'</div><div class="tu-uploader-paste" style="display:none;">'+TUWidget.dicts[TUWidget.locale].uploadToPaste+'</div> </div> </div> <!-- uploader url screen --> <div class="tu-uploaderurl-wrapper"> <div class="tu-uploaderurl-title tu-title-lg">'+TUWidget.dicts[TUWidget.locale].fileFromTheWeb+'</div> <div class="tu-uploadurl-descr tu-descr-sm">'+TUWidget.dicts[TUWidget.locale].attentionToLink+'</div> <div class="tu-uploadurl-form"> <div class="tu-uploadurl-blockinput"> <input placeholder="'+TUWidget.dicts[TUWidget.locale].pasteLink+'" class="tu-uploadurl-input"> </div> <div class="tu-uploadurl-blockbtn"> <button class="tu-uploadurl-btn">'+TUWidget.dicts[TUWidget.locale].buttonUploadLink+'</button> </div> </div> <div class="tu-uploaderurl-link-wrapper"> <div class="tu-uploaderurl-link-img"> <svg viewBox="0 0 4 12" height="12px" width="4px"> <g fill-rule="evenodd" fill="none" stroke-width="1" stroke="none"> <g fill="#FC8665" transform="translate(2.000000, 6.000000) scale(1, -1) translate(-2.000000, -6.000000) "> <path d="M1.8545625,0.1845 L0.09675,3.19035937 C0.0405,3.28879687 0.085359375,3.375 0.197859375,3.375 L1.40639063,3.375 L1.40639063,12 L2.53139063,12 L2.53139063,3.375 L3.71348438,3.375 C3.82598438,3.375 3.88054688,3.28879687 3.81023438,3.19035937 L2.05242188,0.1845 C2.03132813,0.13528125 1.9996875,0.109828125 1.96453125,0.109828125 C1.92923438,0.109828125 1.88971875,0.13528125 1.8545625,0.1845 Z"/> </g> </g> </svg> </div> <div class="tu-uploaderurl-link">'+TUWidget.dicts[TUWidget.locale].backToLocalUpload+"</div> </div> </div> </div> </div></div></div></div>",TUWidget.showUploader=function(){$("#tu-popup").fadeIn(20),$(".tu-popup-content").fadeIn(0,function(){$(this).addClass("tu-popup-content-scale")})},TUWidget.hideUploader=function(e){var t=$("#tu-popup");if(0==t.length)return!1;if(t.fadeOut(40),$("body").removeClass("tu-opened"),t.find(".tu-popup-content").removeClass("tu-popup-content-scale"),tu=t.data("tildaupload"),$elem=t.data("tu-original-elem"),tu.element=$elem.get(0),tu.options.uploadMultiple){var i=tu.getActiveFiles();if(0==i.length&&tu.files.length>0&&1!=e){var s=$("#"+tu.elementid+"-previews");s.length>0&&s.removeClass("tu-popup-progressbar-error").removeClass("tu-popup-progressbar-completed").removeClass("tu-popup-progressbar-uploaded").addClass("tu-popup-progressbar-start")}}t.data("tildaupload",""),t.remove(),$(document).off("paste",TUWidget.popupPasteHandler)},TUWidget.sortFiles=function(){var e=$("#tu-popup");if(e.length>0){var t=e.data("tildaupload");if(t.files&&t.files.length>0){var i=[];e.find(".tu-js-preview-item").each(function(){var e,s=0;for(s=0;s<t.files.length;s++)if(e=t.files[s],e&&e.tuInfo&&$(this).data("tu-url")==e.tuInfo.cdnUrl){i.push(e);break}}),t.files.length==i.length?t.files=i:console.log("Error in sort files")}}},TUWidget.getPopup=function(){var e=$("#tu-popup");return 0==e.length&&($("body").append(TUWidget.htmlPopup),e=$("#tu-popup"),e.find(".tu-uploader-link").click(function(t){return e.find(".tu-popup-content").addClass("tu-linkupload-screen"),!1}),e.find(".tu-uploaderurl-link").click(function(t){return e.find(".tu-popup-content").removeClass("tu-linkupload-screen"),!1}),e.find(".tu-uploader-multiple-nav-btn").click(function(t){e.find(".tu-popup-content").addClass("tu-uploader-multiple-screen")}),e.find(".tu-uploader-multiple-addmore-wrapper").click(function(t){e.find(".tu-popup-content").removeClass("tu-uploader-multiple-screen")}),e.find(".tu-uploader-paste").click(function(t){var i=e.data("tu-original-elem"),s=(i.attr("id"),i.data("tildaupload"));return s.paste(t),!1}),e.find(".tu-js-selected").click(function(){var t=e.data("tu-original-elem"),i=t.attr("id"),s=t.data("tildaupload");TUWidget.sortFiles();var l=s.getActiveFiles();if(l.length>0)return TUWidget.hideUploader(!0),!1;if(s.files.length>0){var o=$("#"+i+"-previews");o.length>0&&o.removeClass("tu-popup-progressbar-error")}if(e.find(".tu-popup-content").removeClass("tu-uploader-multiple-screen"),s.onUserDone&&s.options.uploadMultiple){var r=s.onUserDone;r.call(s,s.files)}TUWidget.hideUploader(!0)}),e.find(".tu-js-removeall").click(function(){var t=e.data("tu-original-elem"),i=(t.attr("id"),t.data("tildaupload"));i.removeAllFiles(!0),e.find(".tu-uploader-multiple-nav-title").html(TUWidget.dicts[TUWidget.locale].defaultMessage),e.find(".tu-uploader-multiple-title").html(""),e.find(".tu-popup-content").removeClass("tu-uploader-multiple-screen").removeClass("tu-uploader-has-miltiple-img")}),$(document).keydown(function(e){27==e.keyCode&&$("body").hasClass("tu-opened")&&TUWidget.hideUploader()}),e.find(".tu-popup-bg, .tu-popup-close, .tu-popup-closer").click(function(e){TUWidget.hideUploader()}),e.find(".tu-uploadurl-blockbtn").click(function(t){var i=e.data("tu-original-elem");i.attr("id");t.preventDefault();var s=$(this).closest(".tu-uploadurl-form").find(".tu-uploadurl-input").val(),l=i.data("tildaupload");return l.uploadFileFromURL(s),!1}),e.find(".tu-uploader-multiple-images").sortable({helper:"clone",items:"div.tu-js-preview-item",opacity:.8,placeholder:"tu-uploader-multiple-img-item",revert:!0,scrollSensitivity:10,tolerance:"pointer"}),e.find(".tu-uploader-multiple-images").disableSelection()),e},TUWidget.popupPasteHandler=function(e){if($popup=$("#tu-popup"),0==$popup.find(".tu-linkupload-screen").length){var t,i=e.originalEvent||e;if(i.clipboardData)if(console.log("PASTED!="+i+", "+i.clipboardData),i.clipboardData.items&&i.clipboardData.items.length>0)t=$popup.data("tildaupload"),t.paste(i);else{var s=i.clipboardData.getData("text/html");
if(s&&s.toLowerCase().indexOf("<img")>0&&(s=s.toLowerCase().split("<img"),s=s[1],s=s.split("src="),s[1])){s=s[1].substring(1);var l=s.indexOf("'"),o=s.indexOf('"');s=o>l&&l>0?s.substring(0,l):s.substring(0,o)}""==s&&(s=i.clipboardData.getData("text/plain"),"http"!=s.substring(0,4)&&(s="")),s>""&&($popup.find(".tu-uploader-link").click(),$popup.find(".tu-uploadurl-input").val(s),$popup.find(".tu-uploadurl-btn").click())}else if(window.clipboardData)if(window.clipboardData.items&&window.clipboardData.items.length>0)t=$popup.data("tildaupload"),t.paste(window);else if(s=window.clipboardData.getData("Html"),s&&s.toLowerCase().indexOf("<img")>0){if(s=s.toLowerCase().split("<img"),s=s[1],s=s.split("src="),s[1]){s=s[1].substring(1);var l=s.indexOf("'"),o=s.indexOf('"');s=o>l&&l>0?s.substring(0,l):s.substring(0,o)}""==s&&(s=window.clipboardData.getData("Text"),"http"!=s.substring(0,4)&&(s="")),s>""&&($popup.find(".tu-uploader-link").click(),$popup.find(".tu-uploadurl-input").val(s),$popup.find(".tu-uploadurl-btn").click())}TUWidget.focusHiddenArea(),e.preventDefault()}},TUWidget.focusHiddenArea=function(){if(0==$("#tu-popup").find(".tu-linkupload-screen").length){var e=$("#tu-hidden-input-paste");e.val(" "),e.focus().select()}},TUWidget.openPopup=function(e){var t,i=TUWidget.getPopup();e.attr("id");t=e.data("tildaupload"),t.element=i.find(".tu-uploader-wrapper").get(0),$("body").addClass("tu-opened"),i.data("tu-original-elem",e),i.data("tildaupload",t),TUWidget.showUploader(),t.waitCompletedForSuccess=!1,t.enableAddDropZone(),t.files.length>0&&t.removeAllFiles(!0),$(document).mouseup(TUWidget.focusHiddenArea),$(document).on("paste",TUWidget.popupPasteHandler),$(document).trigger("mouseup"),t.options.uploadMultiple?i.find(".tu-uploader-button").html(TUWidget.dicts[TUWidget.locale].buttonUploads):i.find(".tu-uploader-button").html(TUWidget.dicts[TUWidget.locale].buttonUpload)},TUWidget.init=function(e){if(0==e.length){var t={};return t.done=function(){return this},t.fail=function(){return this},t.progress=function(){return this},t}var i,s,l,o=e.attr("id"),r=250;o||(o="tuwidget"+parseInt(Math.floor(Math.random()*(9e5+1))+99999),e.attr("id",o));var n="yes"==e.data("tu-multiple")?!0:!1;return"IMG"==e.prop("tagName").toUpperCase()?(s=o,r=e.width(),l="yes"==e.data("tu-noclick")?"":o,previewsContainer=s):"INPUT"==e.prop("tagName").toUpperCase()?(s=o+"-previews",s=o,previewsContainer=o+"-previews",l=o+"-previews","hidden"!=e.attr("type")&&e.hide()):(s=o,r=e.width(),l="yes"!=e.data("tu-noclick")?o:"",previewsContainer=""),i=new Tildaupload("#"+s,{url:TUWidget.urlUploadAPI+"?publickey="+Tildaupload_PUBLICKEY,clickable:!1,thumbnailWidth:r,thumbnailHeight:null,addRemoveLinks:!1,originalelement:e.get(0),additionalDropzone:"#tu-popup .tu-uploader-wrapper",previewsContainer:previewsContainer?"#"+previewsContainer:null,hiddenInputContainer:$("#"+s).parent().get(0),fileNameSize:22,uploadMultiple:n,maxFiles:n?50:1,parallelUploads:n?3:1,locale:TUWidget.locale,dicts:TUWidget.dicts,acceptedFiles:"no"==e.data("tu-is-image")?e.data("tu-accepted-files")>""?e.data("tu-accepted-files"):!1:"image/*"}),i.$originalelement=e,i.on("addedfile",function(e){var t=this.$originalelement,i=t.attr("id");if(this.options.uploadMultiple);else if($("#tu-popup").length>0&&TUWidget.hideUploader(),"IMG"==t.prop("tagName")){if(t.css({opacity:.5}),0==$("#"+i+"-progress").length){var s=t.offset();t.after('<div id="'+i+'-progress" style="width: '+t.width()+"px; height: 3px; box-sizing: border-box; padding: 0; margin:0; position: absolute;background: #000000; top:"+parseInt(s.top+s.height)+"px; left: "+s.left+'px; background: #222222;"><div style="height: 100%; margin:0; padding:0; background: #FC8665; width: 0%; position: relative;" data-tu-uploadprogress></div></div>')}else $("#"+i+"-progress").show(),$("#"+i+"-progress > div").css({width:"0px"});e.previewElement=null}else if("INPUT"==t.prop("tagName"));else if(t.attr("bgimgfield")>""){if(0==$("#"+i+"-progress").length){var s=t.offset();t.prepend('<div id="'+i+'-progress" style="width: '+t.width()+'px; height: 3px; box-sizing: border-box; padding: 0; margin:0; position: absolute;z-index:100;background: #000000; top:0px; left: 0px; background: #222222;"><div style="height: 100%; margin:0; padding:0; background: #FC8665; width: 0%; position: relative;" data-tu-uploadprogress></div></div>')}else $("#"+i+"-progress").show(),$("#"+i+"-progress > div").css({width:"0px"});e.previewElement=null}}),i.on("uploadprogress",function(e,t,i){var s=this.$originalelement,l=s.attr("id");if(this.onUserProgress&&!this.options.uploadMultiple){var o=this.onUserProgress;o.call(this,t,e)}else if($("#"+l+"-progress").length>0&&(t=.8*t,$("#"+l+"-progress").find("div").css({width:t+"%"}),80==t)){var r={width:{start:80,end:95,step:1}};Tildaupload.animate($("#"+l+"-progress").find("div").get(0),r,"slow")}}),n&&(i.on("addedfiles",function(e){var t=this.$originalelement,i=t.attr("id"),s=$("#"+i+"-previews");s.length>0?(s.find("[data-tu-uploadprogress]").css({width:"0%"}),s.removeClass("tu-popup-progressbar-start"),s.removeClass("tu-popup-progressbar-completed"),s.removeClass("tu-popup-progressbar-uploaded"),s.find("[data-tu-name]").html("Uploading "+e.length+" files"),$("#"+i+"-previews").find("[data-tu-size]").html(""+this.sizeUploadedFiles())):$("#"+i+"-progress").length>0&&$("#"+i+"-progress").find("div").css({width:"0%"})}),i.on("totaluploadprogress",function(e,t,i){var s=this.$originalelement,l=s.attr("id");if(this.options.uploadMultiple)if(this.onUserProgress){var o=this.onUserProgress;o.call(this,e)}else if($("#"+l+"-progress").length>0?$("#"+l+"-progress").find("div").css({width:e+"%"}):this.originalelement&&"INPUT"==this.originalelement.nodeName&&$("#"+l+"-previews").length>0&&$("#"+l+"-previews").find("[data-tu-uploadprogress]").css({width:""+parseInt(e)+"%"}),this.options.uploadMultiple&&($popup=$("#tu-popup")).length>0){var r=this.files.length;if(0==r)$popup.find(".tu-uploader-multiple-nav-title").html("Drop file here"),$popup.find(".tu-uploader-multiple-title").html(""),$popup.find(".tu-popup-content").removeClass("tu-uploader-multiple-screen").removeClass("tu-uploader-has-miltiple-img"),$popup.find(".tu-js-selected").hide(),$popup.find(".tu-js-removeall").hide();else{if("RU"==this.options.locale){var n=humanDigits(r,["файл","файла","файлов"]);$popup.find(".tu-uploader-multiple-title").html("Вы выбрали "+r+" "+n),$popup.find(".tu-uploader-multiple-nav-title").html("Вы выбрали "+r+" "+n)}else r+=1==r?" file":" files",$popup.find(".tu-uploader-multiple-title").html("You’ve selected "+r),$popup.find(".tu-uploader-multiple-nav-title").html("You’ve selected "+r);$popup.find(".tu-js-selected").show(),$popup.find(".tu-js-removeall").show(),$("#"+l+"-previews").length>0&&("RU"==this.options.locale?$("#"+l+"-previews").find("[data-tu-name]").html("Загружено файлов: "+this.files.length+", "):$("#"+l+"-previews").find("[data-tu-name]").html("Uploaded "+this.files.length+" files"),$("#"+l+"-previews").find("[data-tu-size]").html(""+this.sizeUploadedFiles()))}}}),i.on("successmultiple",function(e,t){var i=this.$originalelement,s=i.attr("id");if("string"==typeof t&&"{"==t.substring(0,1)&&(t=$.parseJSON(t)),t.result&&t.result.length>0)for(var l=0;l<t.result.length;l++)for(var o=0;o<this.files.length;o++)if(this.files[o].name==t.result[l].originalUrl){this.files[o].tuInfo=t.result[l];break}if(this.originalelement&&"IMG"==this.originalelement.nodeName)i.css({opacity:1}),$("#"+s+"-progress").length>0&&setTimeout(function(){$("#"+s+"-progress").fadeOut(20)},500);else if(this.originalelement&&"INPUT"==this.originalelement.nodeName&&$("#"+s+"-previews").length>0){var r=$("#"+s+"-previews");r.addClass("tu-popup-progressbar-uploaded");var n=this.getActiveFiles().length,a=this.files.length-n;"RU"==this.options.locale?n>0?r.find("[data-tu-name]").html("Загружено файлов: "+a+" из "+this.files.length+", "):r.find("[data-tu-name]").html("Загружено файлов: "+a+", "):n>0?r.find("[data-tu-name]").html("Uploaded "+a+" from "+this.files.length+" files"):r.find("[data-tu-name]").html("Uploaded "+a+" files"),r.find("[data-tu-size]").html(""+this.sizeUploadedFiles());window.setTimeout(function(){r.removeClass("tu-popup-progressbar-uploaded"),r.addClass("tu-popup-progressbar-completed"),r.find("[data-tu-uploadprogress]").css({width:"0%"})},500)}if(0==$("#tu-popup").length&&0==this.getActiveFiles().length&&this.onUserDone&&this.options.uploadMultiple){var p=this.onUserDone;p.call(this,this.files)}}),i.on("errormultiple",function(e){var t=this.$originalelement,i=t.attr("id");if(this.originalelement&&"IMG"==this.originalelement.nodeName);else if(this.originalelement&&"INPUT"==this.originalelement.nodeName&&$("#"+i+"-previews").length>0){var s=$("#"+i+"-previews");s.addClass("tu-popup-progressbar-error"),s.find("[data-tu-errormessage]").html("Error !")}console.log("_["+i+"] error multiple: "+e.length)}),i.on("completemultiple",function(e){var t=this.$originalelement;t.attr("id");if(this.options.uploadMultiple&&e)for(var i=0;i<e.length;i++)file=e[i];0==$("#tu-popup").length&&0==this.getActiveFiles().length&&this.removeAllFiles(!0)})),i.on("thumbnail",function(e,t){var i=this.$originalelement,s=i.attr("id");this.options.uploadMultiple||("IMG"==i.prop("tagName")?i.attr("src",t):i.attr("bgimgfield")?i.find(".t-cover__carrier").length>0?i.find(".t-cover__carrier").css({"background-image":"url("+t+")"}):i.css({"background-image":"url("+t+")"}):0==$("#"+s+"-thumb").length?$("#"+s+"-previews").length>0:"image/"==e.type.substring(0,6)&&$("#"+s+"-thumb").html('<img src="'+t+'" width="250">'))}),i.on("success",function(e,t){var i=this.$originalelement,s=i.attr("id");if(e.tuInfo||(e.tuInfo={}),serverText=t,"string"==typeof t&&console.log("_[#"+s+"] success event error: "+t),t&&t.result&&t.result.length>0)if(this.options.uploadMultiple);else if(e.tuInfo=t.result[0],"IMG"==i.prop("tagName"))i.attr("src",t.result[0].cdnUrl).css({opacity:1}),i.data("tu-value",t.result[0].cdnUrl);else if(i.attr("bgimgfield"))i.find(".t-cover__carrier").length>0?i.find(".t-cover__carrier").css({"background-image":"url("+t.result[0].cdnUrl+")"}):i.css({"background-image":"url("+t.result[0].cdnUrl+")"}),i.data("tu-value",t.result[0].cdnUrl);else{i.val(t.result[0].cdnUrl),0==$("#"+s+"-thumb").length||("image/"==e.type.substring(0,6)?$("#"+s+"-thumb").html('<img src="'+t.result[0].cdnUrl+'" width="250">'):$("#"+s+"-thumb").html(t.result[0].cdnUrl));var l=$("#"+s+"-previews");l.addClass("tu-popup-progressbar-uploaded"),window.setTimeout(function(){l.removeClass("tu-popup-progressbar-uploaded"),l.addClass("tu-popup-progressbar-completed"),l.find("[data-tu-uploadprogress]").css({width:"0%"})},500)}else console.log("event success ["+s+"]: error: "+serverText);if(this.onUserDone&&!this.options.uploadMultiple){var o=this.onUserDone;o.call(this,e)}}),i.on("complete",function(e){var t=this.$originalelement,i=t.attr("id");$("[data-tu-ondrag-hide=yes]").each(function(){"none"==$(this).css("display")&&$(this).data("tu-old-display")&&$(this).css({display:$(this).data("tu-old-display")})}),this.options.uploadMultiple||(e.previewElement=Tildaupload.createElement("<div></div>"),"IMG"==t.prop("tagName")?(t.css({opacity:1}),$("#"+i+"-progress").length>0&&setTimeout(function(){$("#"+i+"-progress").fadeOut(20).remove()},500)):$("#"+i+"-progress").length>0?setTimeout(function(){$("#"+i+"-progress").fadeOut(20).remove()},500):$("#"+i+"-previews").length>0&&$("#"+i+"-previews").find("[data-tu-size]").html(this.filesize(e.size)))}),i.on("queuecomplete",function(){var e=this.$originalelement;e.attr("id");this.options.uploadMultiple||this.removeAllFiles()}),e.data("tildaupload",i),l&&$("#"+l).click(function(t){return t.preventDefault(),TUWidget.openPopup(e),!1}),i},$("[data-tu-ondrag-hide=yes]").on("dragstart dragenter dragover",function(){"none"!=$(this).css("display")&&($(this).data("tu-old-display",$(this).css("display")),$(this).css({display:"none"}))})});