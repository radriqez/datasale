function t_appendGoogleMap(recid,key){var grecid=recid;if("object"==typeof google&&"object"==typeof google.maps)t_handleGoogleApiReady(grecid);else if(window.googleapiiscalled!==!0){var runfunc="window.t_handleGoogleApiReady_"+grecid+' = function () { t_handleGoogleApiReady("'+grecid+'") }';eval(runfunc);var script=document.createElement("script");script.type="text/javascript",script.src="//maps.google.com/maps/api/js?key="+jQuery.trim(key)+"&callback=t_handleGoogleApiReady_"+grecid,document.body.appendChild(script),window.googleapiiscalled=!0}else setTimeout(function(){t_appendGoogleMap(grecid,key)},200)}function t_handleGoogleApiReady(recid){$("#rec"+recid).find(".t-map").each(function(index,Element){function attachInfoMessage(a,b){var c=new google.maps.InfoWindow({content:$("<textarea/>").html(b).text()});a.addListener("click",function(){c.open(a.get("map"),a)})}var el=$(Element),arMarkers=window["arMapMarkers"+recid];if(window.isDragMap=!$isMobile,""!=el.attr("data-map-style"))var mapstyle=eval(el.attr("data-map-style"));else var mapstyle="[]";var myLatLng=arMarkers.length>0&&new google.maps.LatLng(parseFloat(arMarkers[0].lat),parseFloat(arMarkers[0].lng)),myOptions={zoom:parseInt(el.attr("data-map-zoom")),center:myLatLng,scrollwheel:!1,draggable:window.isDragMap,zoomControl:!0,styles:mapstyle},map=new google.maps.Map(Element,myOptions),i,mrk,marker,markers=[],infowindow,bounds=new google.maps.LatLngBounds;for(i in arMarkers)mrk=arMarkers[i],myLatLng=new google.maps.LatLng(parseFloat(mrk.lat),parseFloat(mrk.lng)),marker=new google.maps.Marker({position:myLatLng,map:map,title:mrk.title}),bounds.extend(myLatLng),mrk.descr>""?attachInfoMessage(marker,mrk.descr):attachInfoMessage(marker,mrk.title),markers[markers.length]=marker,infowindow="",marker="";arMarkers.length>1&&(map.fitBounds(bounds),map.getZoom()>parseInt(el.attr("data-map-zoom"))&&map.setZoom(parseInt(el.attr("data-map-zoom")))),google.maps.event.addDomListener(window,"resize",function(){var a=map.getCenter();google.maps.event.trigger(map,"resize"),map.setCenter(a)}),$isMobile&&google.maps.event.addDomListener(window,"dblclick",function(){window.isDragMap?window.isDragMap=!1:window.isDragMap=!0,map.setOptions({draggable:window.isDragMap})})})}function t_appendYandexMap(recid,key){var yarecid=recid;if("object"==typeof ymaps&&"function"==typeof ymaps.Map)t_handleYandexApiReady(recid);else if(window.yandexmapsapiiscalled!==!0){var runfunc="window.t_handleYandexApiReady_"+yarecid+' = function () { return t_handleYandexApiReady("'+yarecid+'") }';eval(runfunc);var script=document.createElement("script");script.type="text/javascript",script.src="https://api-maps.yandex.ru/2.1/?lang=ru-RU&coordorder=latlong&onload=t_handleYandexApiReady_"+yarecid,key>""&&(script.src=script.src+"&apikey="+key),document.body.appendChild(script),window.yandexmapsapiiscalled=!0}else setTimeout(function(){t_appendYandexMap(yarecid,key)},200)}function t_handleYandexApiReady(recid){$("#rec"+recid).find(".t-map").each(function(index,Element){var el=$(Element),arMarkers=window["arMapMarkers"+recid];if(window.isDragMap=!$isMobile,""!=el.attr("data-map-style"))var mapstyle=eval(el.attr("data-map-style"));else var mapstyle="[]";var myLatlng=arMarkers.length>0&&[parseFloat(arMarkers[0].lat),parseFloat(arMarkers[0].lng)],myStates={zoom:parseInt(el.attr("data-map-zoom")),center:myLatlng,scrollZoom:!1,controls:["typeSelector","zoomControl"],drag:window.isDragMap},map=new ymaps.Map(Element,myStates),i,mrk,marker,myGroup=new ymaps.GeoObjectCollection({});map.behaviors.disable("scrollZoom");for(i in arMarkers)mrk=arMarkers[i],myLatlng=[parseFloat(mrk.lat),parseFloat(mrk.lng)],myGroup.add(new ymaps.Placemark(myLatlng,{hintContent:mrk.title,balloonContent:mrk.descr>""?$("<textarea/>").html(mrk.descr).text():mrk.title}));map.geoObjects.add(myGroup),arMarkers.length>1&&map.setBounds(myGroup.getBounds(),{checkZoomRange:!0}),$(window).resize(function(){map.container.fitToViewport()}),$isMobile&&$(window).dblclick(function(){window.isDragMap?window.isDragMap=!1:window.isDragMap=!0,window.isDragMap?map.behaviors.enable("drag"):map.behaviors.disable("drag")})})}